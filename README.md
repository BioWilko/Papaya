# Papaya

A metagenomics pipeline designed for Smart9n nanopore data. Provided as-is currently, not for general use. Papaya is incredibly RAM hungry due to the use of Flye, Minimap2, and Kraken2. We suggest that it should only be run on hardware with >= 100Gb of RAM in which case the `queueSize` parameter in `nextflow.config` should be set to 1, if >=150Gb of RAM is available this can be bumped to 2.

Papaya gathers nanopore `.fastq` output files, optionally expunges host reads from these files, *de novo* assembles metagenome contigs with Flye assembler, optionally polishes them with racon, and attempts to identify them with kraken2. It also runs kraken2 on the individual reads then runs bracken on the report to estimate the composition of the sample at the species level by default (this can be modified via the `bracken_tax_level` parameter).

If you wish to remove host reads a minimap2 indexed host reference mmi file should be provided either with the parameter `expunge_ref_idx` either on the command line or in the `nextflow.config` file. This should be generated by running `minimap2 -d host_reference.mmi host_reference.fasta` where `host_reference.fasta` is a fasta file containing the host reference genome.

A kraken2 db should also be indicated in the same way either via the command line with `kraken_database` or in the `nextflow.config` file, it is recommended that you download a pre-compiled db graciously provided by [Ben Langmead](https://benlangmead.github.io/aws-indexes/k2).

The total number of threads you wish to use should be defined in the `nextflow.config`.

## Mandatory parameters:
### --runpath
Directory containing the Nanopore sequencing run (the directory containing the `fastq_pass` directory)

### --outdir
Directory for outputting pipeline results

## Optional Flags:

### --expunge
If you wish to expunge host reads from the pipeline.

### --polish
If you wish to apply two rounds of racon polishing to the *de novo* assemblies.